import os
from copy import deepcopy

from MAIN_TESTS.change_config import dump_all, load_res, run

from matplotlib import pyplot as plt

from data_generation.tests_configs.final.gfv_components import *
from time_ import TimeDelta

# FINISHED


GOAL_FUNCTION_WEIGHTS = {BTW: 5, WA: 1, UNI: 5, DU: 0.1}
weights = []
gfv_s = []
gfv_components = []
GEN = False
AMOUNT_OF_BUILDINGS = 1
AMOUNT_OF_LAB_ROOMS[0] = 5
AMOUNT_OF_LECT_ROOMS[0] = 2
AMOUNT_OF_LECTURERS = 8

w = [1,1,1,1]
w_o = w[:]
n = 10
s = 3
b_w = None
min_sum = 1000
TIME_GRANULATION = TimeDelta(0, 30)
x = int((n-1)/s)**4
nr = 0



for l in (5, 8, 10, 20):
    GOAL_FUNCTION_WEIGHTS = {BTW: 4, WA: 7, UNI: 5, DU: l}
    res = run(globals())
    val = sum((res.btw, res.wa, res.uni, res.du))
    # val = res.failures
    if val < min_sum:
        min_sum = val
        b_w = deepcopy(GOAL_FUNCTION_WEIGHTS)
    nr+=1
    print(nr,"/",x,'->',b_w)
    print(val)


print(list(zip(*weights)))
print(list(zip(*gfv_components)))
print(gfv_s)
wei = list(zip(*weights))
resl = list(zip(*gfv_components))
cols = 'rgbm'
names = "BTW", "WA", "UNI", "DU"
titles = ["Czas przerw między zajęciami - BTW", "Liczba dni wolnych - WA",
          "Równomierność rozłożenia zajęć w tygodniu - UNI",
          "Pora zajęć w ciągu dnia - DU"]

for j in range(4):
    plt.title(titles[j])
    len_ = int(n/s)+1
    start = j*len_
    end = (j+1)*len_
    print(start, end, len_)
    for i in range(4):
        plt.plot(list(range(0, n+1, s)), resl[i][start:end], cols[i] + "-")
    for i in range(4):
        plt.plot(list(range(0, n+1, s)), resl[i][start:end], cols[i] + ".")
    plt.grid(axis='both')
    plt.legend(names)
    plt.show()

"""
[(0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1), (1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1), (1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1), (1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20)]
[(3.2, 0.9, 0.8, 0.8, 0.8, 0.7, 0.7, 0.7, 0.5, 0.4, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 1.1, 0.9, 1.7, 2.1, 2.4, 2.5, 2.6, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 0.9, 0.9, 1.4, 1.2, 2.1, 2.2, 2.8, 2.7, 2.9, 3.1, 3.7, 3.7, 3.3, 3.6, 3.6, 3.5, 3.7, 3.7, 4.0, 3.7, 3.8, 1.3, 0.9, 1.0, 0.8, 0.9, 0.9, 1.1, 1.2, 1.8, 1.5, 1.8, 1.8, 2.5, 2.5, 2.6, 2.6, 2.7, 2.7, 2.7, 2.7, 2.7), (2.2, 3.1, 3.2, 3.5, 3.5, 3.6, 4.0, 4.8, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 4.8, 3.1, 2.5, 2.4, 2.3, 2.2, 2.2, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 3.1, 3.1, 2.9, 2.9, 2.9, 2.9, 2.6, 2.6, 2.6, 2.7, 2.7, 2.7, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.5, 2.5, 2.5, 3.3, 3.1, 3.4, 3.9, 4.0, 4.4, 4.5, 4.6, 4.8, 4.9, 5.0, 5.0, 4.9, 4.9, 4.9, 4.9, 5.0, 4.9, 4.9, 4.9, 4.9), (0.29, 2.11, 2.29, 2.75, 2.81, 2.93, 3.69, 5.16, 5.57, 5.62, 5.62, 5.62, 5.62, 5.62, 5.62, 5.62, 5.62, 5.62, 5.62, 5.62, 5.62, 5.27, 2.11, 1.0, 0.76, 0.59, 0.35, 0.35, 0.23, 0.23, 0.23, 0.23, 0.23, 0.23, 0.23, 0.23, 0.23, 0.23, 0.23, 0.23, 0.23, 0.23, 2.11, 2.11, 1.76, 1.7, 1.7, 1.7, 1.17, 1.05, 1.05, 1.23, 1.23, 1.23, 1.17, 1.11, 1.11, 1.05, 1.05, 1.05, 0.94, 0.88, 0.88, 2.54, 2.11, 2.58, 3.63, 3.69, 4.45, 4.69, 4.8, 5.27, 5.39, 5.57, 5.62, 5.51, 5.45, 5.45, 5.45, 5.57, 5.51, 5.51, 5.51, 5.51), (3.06, 2.49, 2.33, 2.29, 2.25, 2.18, 2.03, 1.78, 1.8, 1.93, 1.92, 1.92, 1.92, 1.92, 1.92, 1.92, 1.92, 1.92, 1.92, 1.92, 1.92, 1.83, 2.49, 2.68, 2.84, 2.95, 3.02, 3.0, 3.1, 3.1, 3.1, 3.1, 3.1, 3.1, 3.1, 3.1, 3.1, 3.1, 3.1, 3.1, 3.1, 3.1, 2.49, 2.49, 2.59, 2.37, 2.37, 2.48, 2.76, 2.65, 2.73, 2.73, 2.83, 2.83, 2.82, 2.89, 2.89, 2.91, 2.9, 2.9, 2.93, 2.99, 2.99, 4.23, 2.49, 2.26, 1.97, 1.88, 1.73, 1.72, 1.72, 1.68, 1.73, 1.69, 1.68, 1.65, 1.64, 1.63, 1.63, 1.64, 1.64, 1.64, 1.64, 1.64)]
[5.3109672438455, 6.972178141089211, 7.682007633227565, 8.608372582095065, 9.420566472235471, 10.115202676340719, 10.864123558219855, 12.338065918487457, 12.085592054323634, 11.516671385610024, 12.939667964221092, 13.43445963088776, 13.929251297554423, 14.42404296422109, 14.91883463088776, 15.413626297554423, 15.90841796422109, 16.40320963088776, 16.898001297554423, 17.39279296422109, 17.88758463088776, 3.911758042221515, 6.972178141089211, 9.694550671863897, 12.34907192139659, 14.801621987691002, 16.57682207924336, 18.782729376560347, 20.999795388908435, 23.124795388908435, 25.249795388908442, 27.374795388908435, 29.499795388908442, 31.624795388908442, 33.74979538890844, 35.87479538890844, 37.99979538890844, 40.12479538890843, 42.24979538890843, 44.37479538890843, 46.49979538890843, 48.62479538890843, 6.466579861111112, 6.972178141089211, 7.766044656190406, 7.719077676963843, 9.008678825349932, 9.680142415194037, 9.92764353580641, 9.80747770641092, 10.434908543790153, 11.361709675093618, 12.795990289368376, 13.158705637749655, 12.7974951118146, 13.157784663707323, 13.47170479809507, 13.583553088093728, 14.132688693719793, 14.444936815202277, 14.422360232244575, 14.251271101389694, 14.589975671695013, 5.2743586957416415, 6.972178141089211, 9.46562042149203, 11.432549042195788, 13.178181688627053, 14.83500718980072, 16.859337084980904, 18.726183914513683, 21.05002600356988, 22.922789512883906, 24.747706482631326, 26.368751378946584, 28.31038862504982, 29.676314487260445, 31.30674846610442, 32.934352632771095, 35.03475660707293, 36.47837950578589, 38.11509825578589, 39.75181700578588, 41.38853575578589]
"""